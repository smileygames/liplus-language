name: Li+ Wiki Write (Issue #94 Trigger)

on:
  workflow_dispatch:
    inputs:
      wiki_file:
        description: "Wiki page filename (e.g. today.md)"
        required: true
      content_base64:
        description: "Base64 encoded markdown content"
        required: true
      commit_message:
        description: "Commit message"
        required: true

jobs:
  wiki-write:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Wiki repository with PAT
        uses: actions/checkout@v4
        with:
          repository: smileygames/liplus-language.wiki
          token: ${{ secrets.WIKI_PAT }}   # ← これが決定打
          persist-credentials: true

      - name: Create or switch branch
        run: |
          git fetch origin
          git checkout -B feature/wiki-actions

      - name: Write Wiki file
        run: |
          echo "${{ inputs.content_base64 }}" | base64 --decode > "${{ inputs.wiki_file }}"

      - name: Commit and push
        run: |
          git config user.name "Li+ Bot"
          git config user.email "li-plus@users.noreply.github.com"

          git add .
          git commit -m "[Li+ Wiki Write] ${{ inputs.commit_message }}" || echo "No changes to commit"
          git push origin feature/wiki-actions
